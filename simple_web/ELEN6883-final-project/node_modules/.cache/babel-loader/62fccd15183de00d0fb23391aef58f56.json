{"ast":null,"code":"'use strict';\n/**\n * Web Notifications module.\n * @module Growl\n */\n\n/**\n * Save timer references to avoid Sinon interfering (see GH-237).\n */\n\nvar Date = global.Date;\nvar setTimeout = global.setTimeout;\n\nvar EVENT_RUN_END = require('../runner').constants.EVENT_RUN_END;\n/**\n * Checks if browser notification support exists.\n *\n * @public\n * @see {@link https://caniuse.com/#feat=notifications|Browser support (notifications)}\n * @see {@link https://caniuse.com/#feat=promises|Browser support (promises)}\n * @see {@link Mocha#growl}\n * @see {@link Mocha#isGrowlCapable}\n * @return {boolean} whether browser notification support exists\n */\n\n\nexports.isCapable = function () {\n  var hasNotificationSupport = ('Notification' in window);\n  var hasPromiseSupport = typeof Promise === 'function';\n  return process.browser && hasNotificationSupport && hasPromiseSupport;\n};\n/**\n * Implements browser notifications as a pseudo-reporter.\n *\n * @public\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/notification|Notification API}\n * @see {@link https://developers.google.com/web/fundamentals/push-notifications/display-a-notification|Displaying a Notification}\n * @see {@link Growl#isPermitted}\n * @see {@link Mocha#_growl}\n * @param {Runner} runner - Runner instance.\n */\n\n\nexports.notify = function (runner) {\n  var promise = isPermitted();\n  /**\n   * Attempt notification.\n   */\n\n  var sendNotification = function () {\n    // If user hasn't responded yet... \"No notification for you!\" (Seinfeld)\n    Promise.race([promise, Promise.resolve(undefined)]).then(canNotify).then(function () {\n      display(runner);\n    }).catch(notPermitted);\n  };\n\n  runner.once(EVENT_RUN_END, sendNotification);\n};\n/**\n * Checks if browser notification is permitted by user.\n *\n * @private\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Notification/permission|Notification.permission}\n * @see {@link Mocha#growl}\n * @see {@link Mocha#isGrowlPermitted}\n * @returns {Promise<boolean>} promise determining if browser notification\n *     permissible when fulfilled.\n */\n\n\nfunction isPermitted() {\n  var permitted = {\n    granted: function allow() {\n      return Promise.resolve(true);\n    },\n    denied: function deny() {\n      return Promise.resolve(false);\n    },\n    default: function ask() {\n      return Notification.requestPermission().then(function (permission) {\n        return permission === 'granted';\n      });\n    }\n  };\n  return permitted[Notification.permission]();\n}\n/**\n * @summary\n * Determines if notification should proceed.\n *\n * @description\n * Notification shall <strong>not</strong> proceed unless `value` is true.\n *\n * `value` will equal one of:\n * <ul>\n *   <li><code>true</code> (from `isPermitted`)</li>\n *   <li><code>false</code> (from `isPermitted`)</li>\n *   <li><code>undefined</code> (from `Promise.race`)</li>\n * </ul>\n *\n * @private\n * @param {boolean|undefined} value - Determines if notification permissible.\n * @returns {Promise<undefined>} Notification can proceed\n */\n\n\nfunction canNotify(value) {\n  if (!value) {\n    var why = value === false ? 'blocked' : 'unacknowledged';\n    var reason = 'not permitted by user (' + why + ')';\n    return Promise.reject(new Error(reason));\n  }\n\n  return Promise.resolve();\n}\n/**\n * Displays the notification.\n *\n * @private\n * @param {Runner} runner - Runner instance.\n */\n\n\nfunction display(runner) {\n  var stats = runner.stats;\n  var symbol = {\n    cross: '\\u274C',\n    tick: '\\u2705'\n  };\n\n  var logo = require('../../package').notifyLogo;\n\n  var _message;\n\n  var message;\n  var title;\n\n  if (stats.failures) {\n    _message = stats.failures + ' of ' + stats.tests + ' tests failed';\n    message = symbol.cross + ' ' + _message;\n    title = 'Failed';\n  } else {\n    _message = stats.passes + ' tests passed in ' + stats.duration + 'ms';\n    message = symbol.tick + ' ' + _message;\n    title = 'Passed';\n  } // Send notification\n\n\n  var options = {\n    badge: logo,\n    body: message,\n    dir: 'ltr',\n    icon: logo,\n    lang: 'en-US',\n    name: 'mocha',\n    requireInteraction: false,\n    timestamp: Date.now()\n  };\n  var notification = new Notification(title, options); // Autoclose after brief delay (makes various browsers act same)\n\n  var FORCE_DURATION = 4000;\n  setTimeout(notification.close.bind(notification), FORCE_DURATION);\n}\n/**\n * As notifications are tangential to our purpose, just log the error.\n *\n * @private\n * @param {Error} err - Why notification didn't happen.\n */\n\n\nfunction notPermitted(err) {\n  console.error('notification error:', err.message);\n}","map":{"version":3,"sources":["/Users/huyangjinan/Columbia/Blockchain/FinalProject/ELEN6883-final-project/node_modules/mocha/lib/browser/growl.js"],"names":["Date","global","setTimeout","EVENT_RUN_END","require","constants","exports","isCapable","hasNotificationSupport","window","hasPromiseSupport","Promise","process","browser","notify","runner","promise","isPermitted","sendNotification","race","resolve","undefined","then","canNotify","display","catch","notPermitted","once","permitted","granted","allow","denied","deny","default","ask","Notification","requestPermission","permission","value","why","reason","reject","Error","stats","symbol","cross","tick","logo","notifyLogo","_message","message","title","failures","tests","passes","duration","options","badge","body","dir","icon","lang","name","requireInteraction","timestamp","now","notification","FORCE_DURATION","close","bind","err","console","error"],"mappings":"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","sourcesContent":["'use strict';\n\n/**\n * Web Notifications module.\n * @module Growl\n */\n\n/**\n * Save timer references to avoid Sinon interfering (see GH-237).\n */\nvar Date = global.Date;\nvar setTimeout = global.setTimeout;\nvar EVENT_RUN_END = require('../runner').constants.EVENT_RUN_END;\n\n/**\n * Checks if browser notification support exists.\n *\n * @public\n * @see {@link https://caniuse.com/#feat=notifications|Browser support (notifications)}\n * @see {@link https://caniuse.com/#feat=promises|Browser support (promises)}\n * @see {@link Mocha#growl}\n * @see {@link Mocha#isGrowlCapable}\n * @return {boolean} whether browser notification support exists\n */\nexports.isCapable = function() {\n  var hasNotificationSupport = 'Notification' in window;\n  var hasPromiseSupport = typeof Promise === 'function';\n  return process.browser && hasNotificationSupport && hasPromiseSupport;\n};\n\n/**\n * Implements browser notifications as a pseudo-reporter.\n *\n * @public\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/notification|Notification API}\n * @see {@link https://developers.google.com/web/fundamentals/push-notifications/display-a-notification|Displaying a Notification}\n * @see {@link Growl#isPermitted}\n * @see {@link Mocha#_growl}\n * @param {Runner} runner - Runner instance.\n */\nexports.notify = function(runner) {\n  var promise = isPermitted();\n\n  /**\n   * Attempt notification.\n   */\n  var sendNotification = function() {\n    // If user hasn't responded yet... \"No notification for you!\" (Seinfeld)\n    Promise.race([promise, Promise.resolve(undefined)])\n      .then(canNotify)\n      .then(function() {\n        display(runner);\n      })\n      .catch(notPermitted);\n  };\n\n  runner.once(EVENT_RUN_END, sendNotification);\n};\n\n/**\n * Checks if browser notification is permitted by user.\n *\n * @private\n * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/Notification/permission|Notification.permission}\n * @see {@link Mocha#growl}\n * @see {@link Mocha#isGrowlPermitted}\n * @returns {Promise<boolean>} promise determining if browser notification\n *     permissible when fulfilled.\n */\nfunction isPermitted() {\n  var permitted = {\n    granted: function allow() {\n      return Promise.resolve(true);\n    },\n    denied: function deny() {\n      return Promise.resolve(false);\n    },\n    default: function ask() {\n      return Notification.requestPermission().then(function(permission) {\n        return permission === 'granted';\n      });\n    }\n  };\n\n  return permitted[Notification.permission]();\n}\n\n/**\n * @summary\n * Determines if notification should proceed.\n *\n * @description\n * Notification shall <strong>not</strong> proceed unless `value` is true.\n *\n * `value` will equal one of:\n * <ul>\n *   <li><code>true</code> (from `isPermitted`)</li>\n *   <li><code>false</code> (from `isPermitted`)</li>\n *   <li><code>undefined</code> (from `Promise.race`)</li>\n * </ul>\n *\n * @private\n * @param {boolean|undefined} value - Determines if notification permissible.\n * @returns {Promise<undefined>} Notification can proceed\n */\nfunction canNotify(value) {\n  if (!value) {\n    var why = value === false ? 'blocked' : 'unacknowledged';\n    var reason = 'not permitted by user (' + why + ')';\n    return Promise.reject(new Error(reason));\n  }\n  return Promise.resolve();\n}\n\n/**\n * Displays the notification.\n *\n * @private\n * @param {Runner} runner - Runner instance.\n */\nfunction display(runner) {\n  var stats = runner.stats;\n  var symbol = {\n    cross: '\\u274C',\n    tick: '\\u2705'\n  };\n  var logo = require('../../package').notifyLogo;\n  var _message;\n  var message;\n  var title;\n\n  if (stats.failures) {\n    _message = stats.failures + ' of ' + stats.tests + ' tests failed';\n    message = symbol.cross + ' ' + _message;\n    title = 'Failed';\n  } else {\n    _message = stats.passes + ' tests passed in ' + stats.duration + 'ms';\n    message = symbol.tick + ' ' + _message;\n    title = 'Passed';\n  }\n\n  // Send notification\n  var options = {\n    badge: logo,\n    body: message,\n    dir: 'ltr',\n    icon: logo,\n    lang: 'en-US',\n    name: 'mocha',\n    requireInteraction: false,\n    timestamp: Date.now()\n  };\n  var notification = new Notification(title, options);\n\n  // Autoclose after brief delay (makes various browsers act same)\n  var FORCE_DURATION = 4000;\n  setTimeout(notification.close.bind(notification), FORCE_DURATION);\n}\n\n/**\n * As notifications are tangential to our purpose, just log the error.\n *\n * @private\n * @param {Error} err - Why notification didn't happen.\n */\nfunction notPermitted(err) {\n  console.error('notification error:', err.message);\n}\n"]},"metadata":{},"sourceType":"script"}