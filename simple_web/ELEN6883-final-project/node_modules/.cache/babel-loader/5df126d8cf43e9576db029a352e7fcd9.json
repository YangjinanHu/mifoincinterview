{"ast":null,"code":"import { dynamicRequire, fill, logger } from '@sentry/utils';\n/** Tracing integration for node-postgres package */\n\nvar Postgres =\n/** @class */\nfunction () {\n  function Postgres() {\n    /**\n     * @inheritDoc\n     */\n    this.name = Postgres.id;\n  }\n  /**\n   * @inheritDoc\n   */\n\n\n  Postgres.prototype.setupOnce = function (_, getCurrentHub) {\n    var client;\n\n    try {\n      var pgModule = dynamicRequire(module, 'pg');\n      client = pgModule.Client;\n    } catch (e) {\n      logger.error('Postgres Integration was unable to require `pg` package.');\n      return;\n    }\n    /**\n     * function (query, callback) => void\n     * function (query, params, callback) => void\n     * function (query) => Promise\n     * function (query, params) => Promise\n     */\n\n\n    fill(client.prototype, 'query', function (orig) {\n      return function (config, values, callback) {\n        var _a, _b;\n\n        var scope = getCurrentHub().getScope();\n        var parentSpan = (_a = scope) === null || _a === void 0 ? void 0 : _a.getSpan();\n        var span = (_b = parentSpan) === null || _b === void 0 ? void 0 : _b.startChild({\n          description: typeof config === 'string' ? config : config.text,\n          op: \"db\"\n        });\n\n        if (typeof callback === 'function') {\n          return orig.call(this, config, values, function (err, result) {\n            var _a;\n\n            (_a = span) === null || _a === void 0 ? void 0 : _a.finish();\n            callback(err, result);\n          });\n        }\n\n        if (typeof values === 'function') {\n          return orig.call(this, config, function (err, result) {\n            var _a;\n\n            (_a = span) === null || _a === void 0 ? void 0 : _a.finish();\n            values(err, result);\n          });\n        }\n\n        return orig.call(this, config, values).then(function (res) {\n          var _a;\n\n          (_a = span) === null || _a === void 0 ? void 0 : _a.finish();\n          return res;\n        });\n      };\n    });\n  };\n  /**\n   * @inheritDoc\n   */\n\n\n  Postgres.id = 'Postgres';\n  return Postgres;\n}();\n\nexport { Postgres };","map":{"version":3,"mappings":"AAEA,SAASA,cAAT,EAAyBC,IAAzB,EAA+BC,MAA/B,QAA6C,eAA7C;AAQA;;AACA;AAAA;AAAA;AAAA;AAME;;;AAGO,gBAAeC,QAAQ,CAACC,EAAxB;AAoDR;AAlDC;;;;;AAGOD,iCAAP,UAAiBE,CAAjB,EAAwDC,aAAxD,EAAgF;AAC9E,QAAIC,MAAJ;;AAEA,QAAI;AACF,UAAMC,QAAQ,GAAGR,cAAc,CAACS,MAAD,EAAS,IAAT,CAA/B;AACAF,YAAM,GAAGC,QAAQ,CAACE,MAAlB;AACD,KAHD,CAGE,OAAOC,CAAP,EAAU;AACVT,YAAM,CAACU,KAAP,CAAa,0DAAb;AACA;AACD;AAED;;;;;;;;AAMAX,QAAI,CAACM,MAAM,CAACM,SAAR,EAAmB,OAAnB,EAA4B,UAASC,IAAT,EAA4C;AAC1E,aAAO,UAAwBC,MAAxB,EAAyCC,MAAzC,EAA0DC,QAA1D,EAA2E;;;AAChF,YAAMC,KAAK,GAAGZ,aAAa,GAAGa,QAAhB,EAAd;AACA,YAAMC,UAAU,SAAGF,KAAH,MAAQ,IAAR,IAAQG,aAAR,GAAQ,MAAR,GAAQA,GAAEC,OAAF,EAAxB;AACA,YAAMC,IAAI,SAAGH,UAAH,MAAa,IAAb,IAAaI,aAAb,GAAa,MAAb,GAAaA,GAAEC,UAAF,CAAa;AAClCC,qBAAW,EAAE,OAAOX,MAAP,KAAkB,QAAlB,GAA6BA,MAA7B,GAAuCA,MAA2B,CAACY,IAD9C;AAElCC,YAAE,EAAE;AAF8B,SAAb,CAAvB;;AAKA,YAAI,OAAOX,QAAP,KAAoB,UAAxB,EAAoC;AAClC,iBAAOH,IAAI,CAACe,IAAL,CAAU,IAAV,EAAgBd,MAAhB,EAAwBC,MAAxB,EAAgC,UAASc,GAAT,EAAqBC,MAArB,EAAoC;;;AACzE,4BAAI,IAAJ,IAAIV,aAAJ,GAAI,MAAJ,GAAIA,GAAEW,MAAF,EAAJ;AACAf,oBAAQ,CAACa,GAAD,EAAMC,MAAN,CAAR;AACD,WAHM,CAAP;AAID;;AAED,YAAI,OAAOf,MAAP,KAAkB,UAAtB,EAAkC;AAChC,iBAAOF,IAAI,CAACe,IAAL,CAAU,IAAV,EAAgBd,MAAhB,EAAwB,UAASe,GAAT,EAAqBC,MAArB,EAAoC;;;AACjE,4BAAI,IAAJ,IAAIV,aAAJ,GAAI,MAAJ,GAAIA,GAAEW,MAAF,EAAJ;AACAhB,kBAAM,CAACc,GAAD,EAAMC,MAAN,CAAN;AACD,WAHM,CAAP;AAID;;AAED,eAAQjB,IAAI,CAACe,IAAL,CAAU,IAAV,EAAgBd,MAAhB,EAAwBC,MAAxB,EAAqDiB,IAArD,CAA0D,UAACC,GAAD,EAAa;;;AAC7E,0BAAI,IAAJ,IAAIb,aAAJ,GAAI,MAAJ,GAAIA,GAAEW,MAAF,EAAJ;AACA,iBAAOE,GAAP;AACD,SAHO,CAAR;AAID,OA1BD;AA2BD,KA5BG,CAAJ;AA6BD,GA9CM;AAbP;;;;;AAGc/B,gBAAa,UAAb;AAyDhB;AA7DA;;SAAaA","names":["dynamicRequire","fill","logger","Postgres","id","_","getCurrentHub","client","pgModule","module","Client","e","error","prototype","orig","config","values","callback","scope","getScope","parentSpan","_a","getSpan","span","_b","startChild","description","text","op","call","err","result","finish","then","res"],"sources":["/Users/huyangjinan/Columbia/Blockchain/FinalProject/ELEN6883-final-project/node_modules/@sentry/tracing/src/integrations/postgres.ts"],"sourcesContent":["import { Hub } from '@sentry/hub';\nimport { EventProcessor, Integration } from '@sentry/types';\nimport { dynamicRequire, fill, logger } from '@sentry/utils';\n\ninterface PgClient {\n  prototype: {\n    query: () => void | Promise<unknown>;\n  };\n}\n\n/** Tracing integration for node-postgres package */\nexport class Postgres implements Integration {\n  /**\n   * @inheritDoc\n   */\n  public static id: string = 'Postgres';\n\n  /**\n   * @inheritDoc\n   */\n  public name: string = Postgres.id;\n\n  /**\n   * @inheritDoc\n   */\n  public setupOnce(_: (callback: EventProcessor) => void, getCurrentHub: () => Hub): void {\n    let client: PgClient;\n\n    try {\n      const pgModule = dynamicRequire(module, 'pg') as { Client: PgClient };\n      client = pgModule.Client;\n    } catch (e) {\n      logger.error('Postgres Integration was unable to require `pg` package.');\n      return;\n    }\n\n    /**\n     * function (query, callback) => void\n     * function (query, params, callback) => void\n     * function (query) => Promise\n     * function (query, params) => Promise\n     */\n    fill(client.prototype, 'query', function(orig: () => void | Promise<unknown>) {\n      return function(this: unknown, config: unknown, values: unknown, callback: unknown) {\n        const scope = getCurrentHub().getScope();\n        const parentSpan = scope?.getSpan();\n        const span = parentSpan?.startChild({\n          description: typeof config === 'string' ? config : (config as { text: string }).text,\n          op: `db`,\n        });\n\n        if (typeof callback === 'function') {\n          return orig.call(this, config, values, function(err: Error, result: unknown) {\n            span?.finish();\n            callback(err, result);\n          });\n        }\n\n        if (typeof values === 'function') {\n          return orig.call(this, config, function(err: Error, result: unknown) {\n            span?.finish();\n            values(err, result);\n          });\n        }\n\n        return (orig.call(this, config, values) as Promise<unknown>).then((res: unknown) => {\n          span?.finish();\n          return res;\n        });\n      };\n    });\n  }\n}\n"]},"metadata":{},"sourceType":"module"}